{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/app-router-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-server-dom-turbopack-client.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/hooks-client-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/server-inserted-html.ts","../../../../src/contexts/AuthContext.tsx"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].AppRouterContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactServerDOMTurbopackClient\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].HooksClientContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].ServerInsertedHtml\n","\"use client\";\n\nimport { createContext, useContext, useEffect, useState, ReactNode } from 'react';\n// import { User } from '@db/db-js';\nimport { db, Profile, User } from '../lib/db';\n\ntype CompanyInfo = {\n  companyName: string;\n  companyRegistrationNumber?: string;\n  contactPhone?: string;\n  address?: string;\n  city?: string;\n  country?: string;\n};\n\ntype MenuAccess = {\n  menu_key: string;\n  menu_name: string;\n  is_enabled: boolean;\n};\n\ntype AuthContextType = {\n  user: User | null;\n  profile: Profile | null;\n  menuAccess: MenuAccess[];\n  loading: boolean;\n  signIn: (email: string, password: string) => Promise<{ error: Error | null }>;\n  signUp: (email: string, password: string, fullName: string, companyInfo: CompanyInfo) => Promise<{ error: Error | null }>;\n  signOut: () => Promise<void>;\n  refreshProfile: () => Promise<void>;\n  hasMenuAccess: (menuKey: string) => boolean;\n};\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [profile, setProfile] = useState<Profile | null>(null);\n  const [menuAccess, setMenuAccess] = useState<MenuAccess[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  const fetchProfile = async (userId: string) => {\n    const { data, error } = await db\n      .from('profiles')\n      .select('*')\n      .eq('id', userId)\n      .maybeSingle();\n\n    if (error) {\n      console.error('Error fetching profile:', error);\n      return null;\n    }\n\n    return data;\n  };\n\n  const fetchMenuAccess = async (userId: string) => {\n    const { data, error } = await db\n      .from('menu_access_control')\n      .select('menu_key, menu_name, is_enabled')\n      .eq('user_id', userId)\n      .eq('is_enabled', true);\n\n    if (error) {\n      console.error('Error fetching menu access:', error);\n      return [];\n    }\n\n    return data || [];\n  };\n\n  const hasMenuAccess = (menuKey: string) => {\n    if (profile?.role === 'admin') return true;\n    if (menuAccess.length === 0) return true;\n    return menuAccess.some(menu => menu.menu_key === menuKey && menu.is_enabled);\n  };\n\n  const refreshProfile = async () => {\n    if (user) {\n      const profileData = await fetchProfile(user.id);\n      setProfile(profileData);\n      const menuData = await fetchMenuAccess(user.id);\n      setMenuAccess(menuData);\n    }\n  };\n\n  useEffect(() => {\n    // Restore session from localStorage\n    const storedUser = localStorage.getItem('cpaas_user');\n    const storedProfile = localStorage.getItem('cpaas_profile');\n\n    if (storedUser && storedProfile) {\n      setUser(JSON.parse(storedUser));\n      setProfile(JSON.parse(storedProfile));\n      setMenuAccess([]); // Empty means full access\n    }\n    \n    setLoading(false);\n  }, []);\n\n  const signIn = async (email: string, password: string) => {\n    try {\n      // Predefined credentials\n      const predefinedUsers = [\n        { email: 'admin@cpaas.com', password: 'admin123', role: 'admin' as const, name: 'Admin User'},\n        { email: 'presales@cpaas.com', password: 'presales123', role: 'user' as const, name: 'Presales User' },\n        { email: 'sales@cpaas.com', password: 'sales123', role: 'user' as const, name: 'Sales User' },\n      ];\n\n      const matchedUser = predefinedUsers.find(\n        u => u.email.toLowerCase() === email.toLowerCase() && u.password === password\n      );\n\n      if (!matchedUser) {\n        return { error: new Error('Invalid email or password') };\n      }\n\n      // Create mock user and profile with all required fields\n      const mockUser: User = {\n        id: matchedUser.email,\n        aud: 'authenticated',\n        role: 'authenticated',\n        email: matchedUser.email,\n        app_metadata: { role: matchedUser.role },\n        user_metadata: { full_name: matchedUser.name },\n        created_at: new Date().toISOString(),\n        updated_at: new Date().toISOString(),\n      };\n\n      const mockProfile: Profile = {\n        id: matchedUser.email,\n        email: matchedUser.email,\n        full_name: matchedUser.name,\n        organization_name: null,\n        balance: 1000.00,\n        role: matchedUser.role,\n        created_at: new Date().toISOString(),\n        updated_at: new Date().toISOString(),\n      };\n\n      // Store in localStorage for persistence\n      localStorage.setItem('cpaas_user', JSON.stringify(mockUser));\n      localStorage.setItem('cpaas_profile', JSON.stringify(mockProfile));\n\n      setUser(mockUser);\n      setProfile(mockProfile);\n      setMenuAccess([]); // Empty means full access for all\n\n      return { error: null };\n    } catch (error) {\n      return { error: error as Error };\n    }\n  };\n\n  const signUp = async (email: string, password: string, fullName: string, companyInfo: CompanyInfo) => {\n    try {\n      const { data: authData, error: authError } = await db.auth.signUp({\n        email,\n        password,\n      });\n\n      if (authError) return { error: authError };\n\n      if (authData.user) {\n        const { error: profileError } = await db\n          .from('profiles')\n          .insert({\n            id: authData.user.id,\n            email,\n            full_name: fullName,\n            balance: 6.00,\n            role: 'user',\n          });\n\n        if (profileError) return { error: profileError };\n\n        const slug = companyInfo.companyName\n          .toLowerCase()\n          .replace(/[^a-z0-9]+/g, '-')\n          .replace(/^-|-$/g, '');\n\n        const { data: tenantData, error: tenantError } = await db\n          .from('tenants')\n          .insert({\n            name: companyInfo.companyName,\n            slug: `${slug}-${Date.now()}`,\n            contact_email: email,\n            contact_phone: companyInfo.contactPhone || null,\n            company_registration_number: companyInfo.companyRegistrationNumber || null,\n            address: companyInfo.address || null,\n            city: companyInfo.city || null,\n            country: companyInfo.country || null,\n            status: 'active',\n            subscription_tier: 'free',\n          })\n          .select()\n          .single();\n\n        if (tenantError) {\n          console.error('Error creating tenant:', tenantError);\n          return { error: tenantError };\n        }\n\n        const { error: tenantUserError } = await db\n          .from('tenant_users')\n          .insert({\n            tenant_id: tenantData.id,\n            user_id: authData.user.id,\n            role: 'tenant_admin',\n            is_active: true,\n          });\n\n        if (tenantUserError) {\n          console.error('Error linking user to tenant:', tenantUserError);\n          return { error: tenantUserError };\n        }\n      }\n\n      return { error: null };\n    } catch (error) {\n      return { error: error as Error };\n    }\n  };\n\n  const signOut = async () => {\n    localStorage.removeItem('cpaas_user');\n    localStorage.removeItem('cpaas_profile');\n    setUser(null);\n    setProfile(null);\n    setMenuAccess([]);\n  };\n\n  return (\n    <AuthContext.Provider value={{ user, profile, menuAccess, loading, signIn, signUp, signOut, refreshProfile, hasMenuAccess }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","vendored","ReactJsxRuntime","React","AppRouterContext","ReactServerDOMTurbopackClient","HooksClientContext","ServerInsertedHtml"],"mappings":"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","ignoreList":[0,1,2,3,4,5,6]}